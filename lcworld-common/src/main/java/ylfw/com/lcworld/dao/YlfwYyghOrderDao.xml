<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.lcworld.dao.YlfwYyghOrderDao">

	<!-- 可根据自己的需求，是否要使用 -->
    <resultMap type="com.lcworld.entity.YlfwYyghOrderEntity" id="ylfwYyghOrderMap">
        <result property="id" column="id"/>
        <result property="uid" column="uid"/>
        <result property="doctorid" column="doctorid"/>
        <result property="invitemobile" column="invitemobile"/>
        <result property="scheduleid" column="scheduleid"/>
        <result property="createtime" column="createtime"/>
        <result property="changes" column="changes"/>
        <result property="status" column="status"/>
        <result property="ordercode" column="ordercode"/>
        <result property="paytime" column="paytime"/>
        <result property="money" column="money"/>
        <result property="remind" column="remind"/>
        <result property="paytype" column="paytype"/>
        <result property="ghcode" column="ghcode"/>
        <result property="ghpaystatus" column="ghpaystatus"/>
        <result property="ghprice" column="ghprice"/>
        <result property="isdel" column="isdel"/>
        <result property="paystatus" column="paystatus"/>
        <result property="cancelreason" column="cancelreason"/>
    </resultMap>

	<select id="queryObject" resultType="com.lcworld.entity.YlfwYyghOrderEntity">
		select * from t_ylfw_yygh_order where id = #{value}
	</select>

	<select id="queryList" resultType="com.lcworld.entity.YlfwYyghOrderEntity">
		select * from t_ylfw_yygh_order where 1=1
		<if test="payghordercode != null and payghordercode.trim() != ''">
		  and ghcode = #{payghordercode}
		</if>
		<if test="payordercode != null and payordercode.trim() != ''">
		  and ordercode = #{payordercode}
		</if>
        <choose>
            <when test="sidx != null and sidx.trim() != ''">
                order by ${sidx} ${order}
            </when>
			<otherwise>
                order by id desc
			</otherwise>
        </choose>
		<if test="offset != null and limit != null">
			limit #{offset}, #{limit}
		</if>
	</select>
	
 	<select id="queryTotal" resultType="int">
		select count(*) from t_ylfw_yygh_order 
	</select>
	 
	<insert id="save" parameterType="com.lcworld.entity.YlfwYyghOrderEntity" useGeneratedKeys="true" keyProperty="id">
		insert into t_ylfw_yygh_order
		(
			`uid`, 
			`doctorid`, 
			`invitemobile`, 
			`scheduleid`, 
			`createtime`, 
			`changes`, 
			`status`, 
			`ordercode`, 
			`paytime`, 
			`money`, 
			`remind`, 
			`paytype`, 
			`ghcode`, 
			`ghpaystatus`, 
			`ghprice`, 
			`isdel`, 
			`paystatus`,
			`cancelreason`
		)
		values
		(
			#{uid}, 
			#{doctorid}, 
			#{invitemobile}, 
			#{scheduleid}, 
			#{createtime}, 
			#{changes}, 
			#{status}, 
			#{ordercode}, 
			#{paytime}, 
			#{money}, 
			#{remind}, 
			#{paytype}, 
			#{ghcode}, 
			#{ghpaystatus}, 
			#{ghprice}, 
			#{isdel}, 
			#{paystatus},
			#{cancelreason}
		)
	</insert>
	 
	<update id="update" parameterType="com.lcworld.entity.YlfwYyghOrderEntity">
		update t_ylfw_yygh_order 
		<set>
			<if test="uid != null">`uid` = #{uid}, </if>
			<if test="doctorid != null">`doctorid` = #{doctorid}, </if>
			<if test="invitemobile != null">`invitemobile` = #{invitemobile}, </if>
			<if test="scheduleid != null">`scheduleid` = #{scheduleid}, </if>
			<if test="createtime != null">`createtime` = #{createtime}, </if>
			<if test="changes != null">`changes` = #{changes}, </if>
			<if test="status != null">`status` = #{status}, </if>
			<if test="ordercode != null">`ordercode` = #{ordercode}, </if>
			<if test="paytime != null">`paytime` = #{paytime}, </if>
			<if test="money != null">`money` = #{money}, </if>
			<if test="remind != null">`remind` = #{remind}, </if>
			<if test="paytype != null">`paytype` = #{paytype}, </if>
			<if test="ghcode != null">`ghcode` = #{ghcode}, </if>
			<if test="ghpaystatus != null">`ghpaystatus` = #{ghpaystatus}, </if>
			<if test="ghprice != null">`ghprice` = #{ghprice}, </if>
			<if test="isdel != null">`isdel` = #{isdel}, </if>
			<if test="paystatus != null">`paystatus` = #{paystatus},</if>
			<if test="cancelreason != null">`cancelreason` = #{cancelreason}</if>
		</set>
		where id = #{id}
	</update>
	
	<delete id="delete">
		delete from t_ylfw_yygh_order where id = #{value}
	</delete>
	
	<delete id="deleteBatch">
		delete from t_ylfw_yygh_order where id in 
		<foreach item="id" collection="array" open="(" separator="," close=")">
			#{id}
		</foreach>
	</delete>
	
	
	 <resultMap type="com.lcworld.dto.YlfwyyghOrderDTO"  id="ylfwyyghorderResultMap">
        <result column="id" jdbcType="INTEGER" property="id" />
        <result column="doctorid" jdbcType="INTEGER" property="doctorid" />
        <result column="scheduleid" jdbcType="INTEGER" property="scheduleid" />
        <result column="changes" jdbcType="INTEGER" property="changes" />
        <result column="status" jdbcType="INTEGER" property="status" />
        <result column="remind" jdbcType="INTEGER" property="remind" />
        <result column="createtime" jdbcType="VARCHAR" property="createtime" />
        <result column="ordercode" jdbcType="VARCHAR" property="ordercode" />
        <result column="scheduledate" jdbcType="VARCHAR" property="scheduledate" />
        <!-- 所有分类 -->
        <association property="doctor" javaType="com.lcworld.dto.DoctorDTO" 
            column="{doctorid=doctorid}" select="com.lcworld.dao.YlfwYyghDoctorDao.queryDoctorList1">
        </association>
    </resultMap>
	
	<select id="queryOrderdetail" resultMap = "ylfwyyghorderResultMap">
           SELECT
		    a.id,
		    a.doctorid,
		    a.scheduleid,
		    date_format(a.createtime, '%Y-%m-%d') createtime,
		    a.changes,
		    a. STATUS,
		    a.ordercode,
		    a.remind,
		
		IF (
		    a.paystatus = 0
		    OR a.paystatus IS NULL,
		    0,
		    1
		) paystatus,
		
		IF (
		    a.ghpaystatus = 0
		    OR a.ghpaystatus IS NULL,
		    0,
		    1
		) ghpaystatus,
		 CONCAT(
		    date_format(b.scheduledate, '%Y-%m-%d'),
		    ' ',
		    c.starttime
		) scheduledate
		FROM
		    t_ylfw_yygh_order a
		INNER JOIN t_ylfw_yygh_doctor_schedule b ON a.scheduleid = b.id
		INNER JOIN t_ylfw_yygh_period c ON c.id = b.consultperiodid
		WHERE
            1 = 1
        AND a.isdel = 0
        <if test="orderid != null and orderid != ''">
            and a.id =#{orderid}
        </if>
         <if test="statuslist != null and statuslist.size > 0">
          and a.status in 
           <foreach item="id" collection="statuslist" open="(" separator="," close=")">
            #{id}
        </foreach>
        </if>
        order by a.createtime desc 
       
        <if test="offset != null and limit != null">
            limit #{offset}, #{limit}
        </if>
    </select>
    
	<select id="queryOrderlist" resultType = "com.lcworld.dto.YlfwyyghOrderDTO">
           SELECT
		    a.id,
		    a.doctorid,
		    a.scheduleid,
		    date_format(a.createtime, '%Y-%m-%d') createtime,
		    a.changes,
		    a. STATUS,
		    a.ordercode,
		    a.remind,
		
		IF (
		    a.paystatus = 0
		    OR a.paystatus IS NULL,
		    0,
		    1
		) paystatus,
		
		IF (
		    a.ghpaystatus = 0
		    OR a.ghpaystatus IS NULL,
		    0,
		    1
		) ghpaystatus,
		 CONCAT(
		    date_format(b.scheduledate, '%Y-%m-%d'),
		    ' ',
		    c.starttime
		) scheduledate,
		d.photo,d.realname
		FROM
		    t_ylfw_yygh_order a
		INNER JOIN t_ylfw_yygh_doctor_schedule b ON a.scheduleid = b.id
		INNER JOIN t_ylfw_yygh_period c ON c.id = b.consultperiodid
		inner join t_ylfw_yygh_doctor d on d.id = a.doctorid
		WHERE
            1 = 1
        AND a.isdel = 0
        <if test="orderid != null and orderid != ''">
            and a.id =#{orderid}
        </if>
         <if test="statuslist != null and statuslist.size > 0">
          and a.status in 
           <foreach item="id" collection="statuslist" open="(" separator="," close=")">
            #{id}
        </foreach>
        </if>
        order by a.createtime desc 
       
        <if test="offset != null and limit != null">
            limit #{offset}, #{limit}
        </if>
    </select>
    
    
	

</mapper>