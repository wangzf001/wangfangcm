<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.lcworld.dao.YlfwZjzzDoctorScheduleDao">

	<!-- 可根据自己的需求，是否要使用 -->
    <resultMap type="com.lcworld.entity.YlfwZjzzDoctorScheduleEntity" id="ylfwZjzzDoctorScheduleMap">
        <result property="id" column="id"/>
        <result property="doctorid" column="doctorid"/>
        <result property="createtime" column="createtime"/>
        <result property="consultperiodid" column="consultperiodid"/>
        <result property="scheduledate" column="scheduledate"/>
        <result property="status" column="status"/>
    </resultMap>

	<select id="queryObject" resultType="com.lcworld.entity.YlfwZjzzDoctorScheduleEntity">
		select * from t_ylfw_zjzz_doctor_schedule where id = #{value}
	</select>

	<select id="queryList" resultType="com.lcworld.entity.YlfwZjzzDoctorScheduleEntity">
		select * from t_ylfw_zjzz_doctor_schedule
        <choose>
            <when test="sidx != null and sidx.trim() != ''">
                order by ${sidx} ${order}
            </when>
			<otherwise>
                order by id desc
			</otherwise>
        </choose>
		<if test="offset != null and limit != null">
			limit #{offset}, #{limit}
		</if>
	</select>
	
 	<select id="queryTotal" resultType="int">
		select count(*) from t_ylfw_zjzz_doctor_schedule 
	</select>
	 
	<insert id="save" parameterType="com.lcworld.entity.YlfwZjzzDoctorScheduleEntity" useGeneratedKeys="true" keyProperty="id">
		insert into t_ylfw_zjzz_doctor_schedule
		(
			`doctorid`, 
			`createtime`, 
			`consultperiodid`, 
			`scheduledate`, 
			`status`
		)
		values
		(
			#{doctorid}, 
			#{createtime}, 
			#{consultperiodid}, 
			#{scheduledate}, 
			#{status}
		)
	</insert>
	 
	<update id="update" parameterType="com.lcworld.entity.YlfwZjzzDoctorScheduleEntity">
		update t_ylfw_zjzz_doctor_schedule 
		<set>
			<if test="doctorid != null">`doctorid` = #{doctorid}, </if>
			<if test="createtime != null">`createtime` = #{createtime}, </if>
			<if test="consultperiodid != null">`consultperiodid` = #{consultperiodid}, </if>
			<if test="scheduledate != null">`scheduledate` = #{scheduledate}, </if>
			<if test="status != null">`status` = #{status}</if>
		</set>
		where id = #{id}
	</update>
	
	<delete id="delete">
		delete from t_ylfw_zjzz_doctor_schedule where id = #{value}
	</delete>
	
	<delete id="deleteBatch">
		delete from t_ylfw_zjzz_doctor_schedule where id in 
		<foreach item="id" collection="array" open="(" separator="," close=")">
			#{id}
		</foreach>
	</delete>
	
	   <select id="queryDocSchedules" resultMap="expertScheduleDTO">
        select a.scheduleDate,   b.starttime,
            b.endtime,
            a.id,
             IF (
            a.status = 0
            OR a.status IS NULL,
            0,
            1
        ) status from t_ylfw_zjzz_doctor_schedule a
        INNER  JOIN t_ylfw_zjzz_period b 
        on a.consultperiodid = b.id
         WHERE
            a.doctorid = #{doctorid}
            and str_to_date(CONCAT(a.scheduledate,b.starttime),'%Y-%m-%d %H:%i') > now()
       
    </select>
    
      <select id="queryScheduleList" resultType="com.lcworld.dto.LffwBarberScheduleEntityDTO">
        SELECT
            a.createtime,
            a.id,
            a.scheduledate,
            a.`status`,
            b.starttime,
            b.endtime
        FROM
            t_ylfw_zjzz_doctor_schedule a
        left JOIN t_ylfw_zjzz_period b ON a.consultperiodid = b.id
        WHERE
            a.doctorid = #{doctorid}
           <if test="status != null and status != ''" > and a.status = #{status}</if>
           <if test="starttime != null and starttime != ''"> and str_to_date(CONCAT(a.scheduledate,b.starttime),'%Y-%m-%d %H:%i') &gt;= str_to_date(#{starttime},'%Y-%m-%d %H:%i')</if>
           <if test="endtime != null and endtime != ''"> and str_to_date(CONCAT(a.scheduledate,b.starttime),'%Y-%m-%d %H:%i') &lt;= str_to_date(#{endtime},'%Y-%m-%d %H:%i')</if>
        order by str_to_date(CONCAT(a.scheduledate,b.starttime),'%Y-%m-%d %H:%i') desc
        <if test="offset != null and limit != null">
            limit #{offset}, #{limit}
        </if>
    </select>
    
    <select id="queryScheduleTotal" resultType="int">
          SELECT
           count(*)
        FROM
            t_ylfw_zjzz_doctor_schedule a
        left JOIN t_ylfw_zjzz_period b ON a.consultperiodid = b.id
        WHERE
            a.doctorid = #{doctorid}
            
            <if test="status != null and status != ''" > and a.status = #{status}</if>
           <if test="starttime != null and starttime != ''"> and str_to_date(CONCAT(a.scheduledate,b.starttime),'%Y-%m-%d %H:%i') &gt;= str_to_date(#{starttime},'%Y-%m-%d %H:%i')</if>
           <if test="endtime != null and endtime != ''"> and str_to_date(CONCAT(a.scheduledate,b.starttime),'%Y-%m-%d %H:%i') &lt;= str_to_date(#{endtime},'%Y-%m-%d %H:%i')</if>
    </select>
    
     <resultMap type="com.lcworld.dto.ExpertScheduleDTO"  id="expertScheduleDTO">
          <result property="scheduleDate" column="scheduleDate"/>
        <!-- 所有分类 -->
        <collection property="schedulelist" javaType="list" ofType="com.lcworld.entity.YlfwZjzzPeriodEntity">
             <result property="id" column="id"/>
            <result property="starttime" column="starttime"/>
            <result property="endtime" column="endtime"/>
            <result property="consultperiodid" column="consultperiodid"/>
            <result property="status" column="status"/>
        </collection>
    </resultMap>
    
    <insert id="saveBatch" parameterType="java.util.List" >
       insert into t_ylfw_zjzz_doctor_schedule
        (
            `doctorid`, 
            `createtime`, 
            `consultperiodid`, 
            `scheduledate`, 
            `status`
        )
        values
       
       <foreach collection="list" item="item" index="index"
            separator=",">
             (
            #{item.doctorid}, 
            #{item.createtime}, 
            #{item.consultperiodid}, 
            #{item.scheduledate}, 
            #{item.status}
        )
        </foreach>
    </insert>
    
    
    

</mapper>